# 보험 서류 검증 시스템 v2.0 강화판

## 🚀 새로운 기능 (v2.0)

### 1️⃣ **실패 케이스 디버깅 시스템**

- **실패 원인 상세 분석**: ROI별로 실패한 이유를 구체적으로 분석
- **이미지 저장**: 템플릿과 검증 이미지를 자동으로 저장하여 시각적 비교
- **개선 권장사항**: SSIM 점수, OCR 신뢰도 등을 기반으로 임계값 조정 제안
- **상세 리포트**: JSON 및 텍스트 형태로 디버깅 정보 저장

### 2️⃣ **PDF 재업로드 및 재검사**

- **즉시 재검사**: 다른 PDF 파일로 바로 재검사 가능
- **연속 검사 모드**: PDF 선택 후 자동으로 검증 실행
- **검사 이력 관리**: 최근 검사한 PDF들의 이력 저장 및 재검사
- **빠른 재검사**: 현재 PDF로 즉시 재검증

### 3️⃣ **ROI 템플릿 편집**

- **기존 템플릿 불러오기**: 저장된 템플릿을 로드하여 수정
- **실시간 편집**: ROI 영역 추가/삭제/수정
- **다른 이름으로 저장**: 기존 템플릿을 복사하여 새 템플릿 생성
- **템플릿 관리**: 템플릿 목록 보기, 삭제 등

### 4️⃣ **체계적 폴더 구조**

- **보험사별 분류**: 삼성화재, DB손해보험, 현대해상 등
- **템플릿별 정리**: 각 템플릿에 대한 결과를 별도 폴더에 저장
- **성공/실패 구분**: 검증 결과에 따라 자동 분류

## ⚠️ 중요: 한글 OCR 설정 필수!

**첫 실행 전에 반드시 한글 언어팩을 설치해야 합니다:**

### 🔧 자동 설치 (권장)
```bash
# 1. 자동 설치 스크립트 실행
install_korean_ocr.bat

# 2. 또는 Python 스크립트 실행  
python setup_tesseract_korean.py

# 3. 설치 확인
python check_tesseract.py
```

### 📁 수동 설치
다음 파일들을 `vendor/tesseract/tessdata/` 폴더에 저장:
- [영어 언어팩](https://github.com/tesseract-ocr/tessdata/raw/main/eng.traineddata)
- [한글 언어팩](https://github.com/tesseract-ocr/tessdata/raw/main/kor.traineddata)

## 🎯 사용 방법

### **방법 1: 통합 런처 사용 (권장)**

```bash
python enhanced_launcher.py
```

### **방법 2: 개별 실행**

```bash
python src/template_manager.py     # 템플릿 설정
python src/pdf_validator_gui.py    # 서류 검증
```

## 📁 새로운 폴더 구조

```
pdfdiff/
├── templates/                  ← 템플릿 저장
│   ├── 삼성화재/
│   ├── DB손해보험/
│   └── 현대해상/
├── output/                     ← 검증 결과
│   ├── 삼성화재/
│   │   ├── 자동차보험/
│   │   │   ├── fail/          ← 실패 케이스
│   │   │   └── success/       ← 성공 케이스
│   │   └── 화재보험/
│   └── DB손해보험/
└── src/                        ← 소스 코드
    ├── validation_debugger.py
    ├── pdf_reload_functionality.py
    ├── template_editor.py
    ├── folder_manager.py
    └── enhanced_launcher.py
```

## 🔍 디버깅 모드 상세

**실패한 ROI에 대해 다음 정보를 자동 분석:**

### OCR 방식 실패 분석

- 템플릿과 검증 텍스트 추출 결과
- 텍스트 길이 차이 계산
- OCR 신뢰도 점수
- 인식된 단어 수

### Contour 방식 실패 분석

- 여러 임계값(20, 30, 40, 50)으로 테스트
- 감지된 윤곽선 개수 및 면적
- 최적 임계값 추천
- 차이 이미지 저장

### SSIM 분석 (공통)

- 구조적 유사도 점수
- 유사도 백분율
- 너무 유사한 경우 경고
- 권장 임계값 제안

## 🎮 핵심 개선점

### 사용자 관점

- **워크플로 단순화**: 3단계로 명확한 프로세스
- **즉시 피드백**: 실패 원인을 바로 확인 가능
- **반복 작업 최적화**: PDF 재업로드로 빠른 재검사
- **실수 방지**: 이력 관리로 놓친 파일 없음

### 개발자 관점

- **모듈화**: 기능별로 분리된 독립 모듈
- **확장성**: 새 기능 추가가 용이한 구조
- **유지보수성**: 명확한 책임 분리
- **디버깅**: 상세한 로그 및 분석 도구

## 📈 성능 개선사항

### 백엔드 최적화

- **메모리 효율성**: PDF 문서 자동 해제
- **에러 핸들링**: 상세한 예외 처리 및 로깅
- **파일 I/O**: 안전한 파일 읽기/쓰기
- **이미지 처리**: 최적화된 OpenCV 연산

### 프론트엔드 개선

- **사용자 경험**: 직관적인 버튼 배치
- **진행 상황**: 실시간 프로그레스 바
- **에러 메시지**: 명확한 오류 안내
- **키보드 단축키**: 빠른 작업을 위한 단축키

## 🎯 Before vs After

| 기능        | v1.0                | v2.0 강화판              |
| ----------- | ------------------- | ------------------------ |
| 템플릿 편집 | ❌ 새로 만들어야 함 | ✅ 기존 템플릿 수정 가능 |
| 실패 분석   | ❌ 단순 실패 표시   | ✅ 상세 원인 분석        |
| PDF 재검사  | ❌ 도구 재시작 필요 | ✅ 즉시 재업로드         |
| 결과 관리   | ❌ 단일 폴더에 혼재 | ✅ 체계적 분류 저장      |
| 검사 이력   | ❌ 기록 없음        | ✅ 이력 관리             |
| 디버깅      | ❌ 수동 분석        | ✅ 자동 분석 및 권장사항 |

## 🎉 결론

이번 v2.0 강화판으로 보험 서류 검증 시스템이 단순한 검증 도구에서 **전문적인 품질 관리 플랫폼**으로 발전했습니다.

**개발자에게는** 모듈화된 구조와 상세한 디버깅 정보를, **사용자에게는** 직관적인 워크플로와 즉시 피드백을 제공합니다.

특히 **실패 케이스 디버깅** 기능으로 "왜 실패했는지"를 명확히 알 수 있어, 템플릿 품질 개선과 검증 정확도 향상이 가능해졌습니다.
